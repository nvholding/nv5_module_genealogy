!function(e){"use strict";var t=function e(){var t;return{escape:function e(t){return t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")},parseExtension:n,mimeType:function e(t){var r,o,i=n(t).toLowerCase();return({woff:r="application/font-woff",woff2:r,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:o="image/jpeg",jpeg:o,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"})[i]||""},dataAsUrl:function e(t,n){return"data:"+n+";base64,"+t},isDataUrl:function e(t){return -1!==t.search(/^(data:)/)},canvasToBlob:function e(t){var n;return t.toBlob?new Promise(function(e){t.toBlob(e)}):(n=t,new Promise(function(e){for(var t=window.atob(n.toDataURL().split(",")[1]),r=t.length,o=new Uint8Array(r),i=0;i<r;i++)o[i]=t.charCodeAt(i);e(new Blob([o],{type:"image/png"}))}))},resolveUrl:function e(t,n){var r=document.implementation.createHTMLDocument(),o=r.createElement("base");r.head.appendChild(o);var i=r.createElement("a");return r.body.appendChild(i),o.href=n,i.href=t,i.href},getAndEncode:function e(t){return u.impl.options.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+new Date().getTime()),new Promise(function(e){var n,r=new XMLHttpRequest;if(r.onreadystatechange=function o(){if(4===r.readyState){if(200!==r.status){n?e(n):i("cannot fetch resource: "+t+", status: "+r.status);return}var u=new FileReader;u.onloadend=function(){e(u.result.split(/,/)[1])},u.readAsDataURL(r.response)}},r.ontimeout=function r(){n?e(n):i("timeout of 30000ms occured while fetching resource: "+t)},r.responseType="blob",r.timeout=3e4,r.open("GET",t,!0),r.send(),u.impl.options.imagePlaceholder){var o=u.impl.options.imagePlaceholder.split(/,/);o&&o[1]&&(n=o[1])}function i(t){console.error(t),e("")}})},uid:(t=0,function(){return"u"+("0000"+(1679616*Math.random()<<0).toString(36)).slice(-4)+t++}),delay:function e(t){return function(e){return new Promise(function(n){setTimeout(function(){n(e)},t)})}},asArray:function e(t){for(var n=[],r=t.length,o=0;o<r;o++)n.push(t[o]);return n},escapeXhtml:function e(t){return t.replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function e(t){return new Promise(function(e,n){var r=new Image;r.onload=function(){e(r)},r.onerror=n,r.src=t})},width:function e(t){var n=r(t,"border-left-width"),o=r(t,"border-right-width");return t.scrollWidth+n+o},height:function e(t){var n=r(t,"border-top-width"),o=r(t,"border-bottom-width");return t.scrollHeight+n+o}};function n(e){var t=/\.([^\.\/]*?)$/g.exec(e);return t?t[1]:""}function r(e,t){return parseFloat(window.getComputedStyle(e).getPropertyValue(t).replace("px",""))}}(),n=function e(){var n=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function e(t,n,u){return r(t)?Promise.resolve(t).then(o).then(function(e){var r=Promise.resolve(t);return e.forEach(function(e){r=r.then(function(t){return i(t,e,n,u)})}),r}):Promise.resolve(t)},shouldProcess:r,impl:{readUrls:o,inline:i}};function r(e){return -1!==e.search(n)}function o(e){for(var r,o=[];null!==(r=n.exec(e));)o.push(r[1]);return o.filter(function(e){return!t.isDataUrl(e)})}function i(e,n,r,o){return Promise.resolve(n).then(function(e){return r?t.resolveUrl(e,r):e}).then(o||t.getAndEncode).then(function(e){return t.dataAsUrl(e,t.mimeType(n))}).then(function(r){var o;return e.replace((o=n,RegExp("(url\\(['\"]?)("+t.escape(o)+")(['\"]?\\))","g")),"$1"+r+"$3")})}}(),r=function e(){return{resolveAll:function e(){return r(document).then(function(e){return Promise.all(e.map(function(e){return e.resolve()}))}).then(function(e){return e.join("\n")})},impl:{readAll:r}};function r(){return Promise.resolve(t.asArray(document.styleSheets)).then(function e(n){var r=[];return n.forEach(function(e){try{t.asArray(e.cssRules||[]).forEach(r.push.bind(r))}catch(n){console.log("Error while reading CSS rules from "+e.href,n.toString())}}),r}).then(function e(t){return t.filter(function(e){return e.type===CSSRule.FONT_FACE_RULE}).filter(function(e){return n.shouldProcess(e.style.getPropertyValue("src"))})}).then(function(t){return t.map(e)});function e(e){return{resolve:function t(){var r=(e.parentStyleSheet||{}).href;return n.inlineAll(e.cssText,r)},src:function(){return e.style.getPropertyValue("src")}}}}}(),o=function e(){return{inlineAll:function e(o){var i,u;return o instanceof Element?(i=o,u=i.style.getPropertyValue("background"),u?n.inlineAll(u).then(function(e){i.style.setProperty("background",e,i.style.getPropertyPriority("background"))}).then(function(){return i}):Promise.resolve(i)).then(function(){return o instanceof HTMLImageElement?r(o).inline():Promise.all(t.asArray(o.childNodes).map(function(t){return e(t)}))}):Promise.resolve(o)},impl:{newImage:r}};function r(e){return{inline:function n(r){return t.isDataUrl(e.src)?Promise.resolve():Promise.resolve(e.src).then(r||t.getAndEncode).then(function(n){return t.dataAsUrl(n,t.mimeType(e.src))}).then(function(t){return new Promise(function(n,r){e.onload=n,e.onerror=r,e.src=t})})}}}}(),i={imagePlaceholder:void 0,cacheBust:!1},u={toSvg:a,toPng:function e(t,n){return c(t,n||{}).then(function(e){return e.toDataURL()})},toJpeg:function e(t,n){return c(t,n=n||{}).then(function(e){return e.toDataURL("image/jpeg",n.quality||1)})},toBlob:function e(n,r){return c(n,r||{}).then(t.canvasToBlob)},toPixelData:function e(n,r){return c(n,r||{}).then(function(e){return e.getContext("2d").getImageData(0,0,t.width(n),t.height(n)).data})},impl:{fontFaces:r,images:o,util:t,inliner:n,options:{}}};function a(e,n){var r;return void 0===(r=n=n||{}).imagePlaceholder?u.impl.options.imagePlaceholder=i.imagePlaceholder:u.impl.options.imagePlaceholder=r.imagePlaceholder,void 0===r.cacheBust?u.impl.options.cacheBust=i.cacheBust:u.impl.options.cacheBust=r.cacheBust,Promise.resolve(e).then(function(e){return function e(n,r,o){return o||!r||r(n)?Promise.resolve(n).then(function e(n){return n instanceof HTMLCanvasElement?t.makeImage(n.toDataURL()):n.cloneNode(!1)}).then(function(o){var i,u,a,c,l,s,f,h;return i=n,u=o,a=r,c=i.childNodes,0===c.length?Promise.resolve(u):(l=u,s=t.asArray(c),f=a,h=Promise.resolve(),s.forEach(function(t){h=h.then(function(){return e(t,f)}).then(function(e){e&&l.appendChild(e)})}),h).then(function(){return u})}).then(function(e){var r,o;return r=n,o=e,o instanceof Element?Promise.resolve().then(function e(){var n,i;n=window.getComputedStyle(r),i=o.style,n.cssText?i.cssText=n.cssText:function e(n,r){t.asArray(n).forEach(function(e){r.setProperty(e,n.getPropertyValue(e),n.getPropertyPriority(e))})}(n,i)}).then(function e(){[":before",":after"].forEach(function(e){(function e(n){var i=window.getComputedStyle(r,n),u=i.getPropertyValue("content");if(""!==u&&"none"!==u){var a=t.uid();o.className=o.className+" "+a;var c,l,s,f,h,g,d,p=document.createElement("style");p.appendChild((c=a,l=n,s=i,d=s.cssText?(f=s,h=f.getPropertyValue("content"),f.cssText+" content: "+h+";"):(g=s,t.asArray(g).map(function e(t){return t+": "+g.getPropertyValue(t)+(g.getPropertyPriority(t)?" !important":"")}).join("; ")+";"),document.createTextNode("."+c+":"+l+"{"+d+"}"))),o.appendChild(p)}})(e)})}).then(function e(){r instanceof HTMLTextAreaElement&&(o.innerHTML=r.value),r instanceof HTMLInputElement&&o.setAttribute("value",r.value)}).then(function e(){o instanceof SVGElement&&(o.setAttribute("xmlns","http://www.w3.org/2000/svg"),o instanceof SVGRectElement&&["width","height"].forEach(function(e){var t=o.getAttribute(e);t&&o.style.setProperty(e,t)}))}).then(function(){return o}):o}):Promise.resolve()}(e,n.filter,!0)}).then(l).then(s).then(function e(t){return n.bgcolor&&(t.style.backgroundColor=n.bgcolor),n.width&&(t.style.width=n.width+"px"),n.height&&(t.style.height=n.height+"px"),n.style&&Object.keys(n.style).forEach(function(e){t.style[e]=n.style[e]}),t}).then(function(r){var o,i,u;return o=r,i=n.width||t.width(e),u=n.height||t.height(e),Promise.resolve(o).then(function(e){return e.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),new XMLSerializer().serializeToString(e)}).then(t.escapeXhtml).then(function(e){return'<foreignObject x="0" y="0" width="100%" height="100%">'+e+"</foreignObject>"}).then(function(e){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+i+'" height="'+u+'">'+e+"</svg>"}).then(function(e){return"data:image/svg+xml;charset=utf-8,"+e})})}function c(e,n){return a(e,n).then(t.makeImage).then(t.delay(100)).then(function(r){var o=function e(r){var o=document.createElement("canvas");if(o.width=n.width||t.width(r),o.height=n.height||t.height(r),n.bgcolor){var i=o.getContext("2d");i.fillStyle=n.bgcolor,i.fillRect(0,0,o.width,o.height)}return o}(e);return o.getContext("2d").drawImage(r,0,0),o})}function l(e){return r.resolveAll().then(function(t){var n=document.createElement("style");return e.appendChild(n),n.appendChild(document.createTextNode(t)),e})}function s(e){return o.inlineAll(e).then(function(){return e})}"undefined"!=typeof module?module.exports=u:e.domtoimage=u}(this);
